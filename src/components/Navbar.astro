---
import { getCollection } from "astro:content";
import { siteConfig } from "../data/site";
import { getPostUrl } from "../utils/postUrl";

interface Props {
  isHome?: boolean;
  showShareNav?: boolean;
}

const { isHome = false, showShareNav = false } = Astro.props;

const posts = (await getCollection("blog")).sort(
  (a, b) => b.data.date.valueOf() - a.data.date.valueOf(),
);
const recentPosts = posts.slice(0, siteConfig.postAmount.sidebar);
const menuItems = [...siteConfig.menu].sort((a, b) => a.weight - b.weight);
---

<!-- Header -->
<header id="header">
  {
    isHome ? (
      <h1>
        <a href="/">{siteConfig.navbarTitle}</a>
      </h1>
    ) : (
      <h2>
        <a href="/">{siteConfig.navbarTitle}</a>
      </h2>
    )
  }

  <nav class="links">
    <ul>
      {
        menuItems.map((item) => (
          <li>
            <a href={item.url}>
              {item.icon && (
                <Fragment>
                  <i class={item.icon}>&nbsp;</i>
                </Fragment>
              )}
              {item.name}
            </a>
          </li>
        ))
      }
    </ul>
  </nav>
  <nav class="main">
    <ul>
      {
        showShareNav && (
          <li id="share-nav" class="share-menu" style="display:none;">
            <a class="fa-share-alt" href="#share-menu">
              Share
            </a>
          </li>
        )
      }
      <li class="search">
        <a class="fa-search" href="#search">Search</a>
        <form id="search" method="get" action="//google.com/search">
          <input type="text" name="q" placeholder="Search" />
          <input type="hidden" name="q" value={`site:${siteConfig.baseUrl}`} />
        </form>
      </li>
      <li class="menu">
        <a class="fa-bars" href="#menu">Menu</a>
      </li>
    </ul>
  </nav>
</header>

<!-- Menu -->
<section id="menu">
  <!-- Search -->
  <section>
    <form class="search" method="get" action="//google.com/search">
      <input type="text" name="q" placeholder="Search" />
      <input type="hidden" name="q" value={`site:${siteConfig.baseUrl}`} />
    </form>
  </section>

  <!-- Links -->
  <section>
    <ul class="links">
      {
        menuItems.map((item) => (
          <li>
            <a href={item.url}>
              <h3>
                {item.icon && (
                  <Fragment>
                    <i class={item.icon}>&nbsp;</i>
                  </Fragment>
                )}
                {item.name}
              </h3>
            </a>
          </li>
        ))
      }
    </ul>
  </section>

  <!-- Recent Posts -->
  <section>
    <ul class="links">
      <header>
        <h3>Recent Posts</h3>
      </header>
      {
        recentPosts.map((post) => (
          <li>
            <a href={getPostUrl(post.slug)}>
              <p>{post.data.title}</p>
            </a>
          </li>
        ))
      }
    </ul>
  </section>
</section>
