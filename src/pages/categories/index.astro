---
import PageWithSidebar from "../../layouts/PageWithSidebar.astro";
import { getCollection } from "astro:content";

const posts = await getCollection("blog");

// Build category â†’ count map
const categoryMap = new Map<string, number>();
for (const post of posts) {
  for (const cat of post.data.categories) {
    categoryMap.set(cat, (categoryMap.get(cat) ?? 0) + 1);
  }
}

// Sort by count descending, then alphabetically
const categories = [...categoryMap.entries()].sort((a, b) => {
  if (b[1] !== a[1]) return b[1] - a[1];
  return a[0].localeCompare(b[0]);
});
---

<PageWithSidebar title="Categories" showCategories={false}>
  <article class="post">
    <header>
      <div class="title">
        <h1>Categories</h1>
      </div>
    </header>
    <ul class="actions">
      {
        categories.map(([name, count]) => (
          <li>
            <a href={`/categories/${name.toLowerCase()}/`}>
              {name} ({count})
            </a>
          </li>
        ))
      }
    </ul>
  </article>
</PageWithSidebar>
